---
import { marked } from "marked";
import { directusFetchItems } from "../lib/directus";

const news = await directusFetchItems<{ id: number; date_created: string; body: string }>("news", {
  fields: ["id", "date_created", "body"],
  sort: ["-date_created"],
  limit: 50,
});
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Games</title>
    <style>
      body{background:#0b0b0b;color:#eaeaea;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;}
      a{color:#9aa6ff;text-decoration:none;}
      header{padding:24px;border-bottom:1px solid #1e1e1e;background:#0d0d0d;position:sticky;top:0;}
      nav{display:flex;gap:16px;flex-wrap:wrap;}
      main{max-width:960px;margin:0 auto;padding:24px;}
      .news-item{border:1px solid #232323;border-radius:12px;padding:16px;margin:16px 0;background:#111;}
      .news-date{font-size:.85rem;opacity:.7;margin-bottom:8px;}
      .news-body :global(p){margin:0 0 12px 0;}
      .news-body :global(a){color:#8ab4f8;}
      .news-body :global(code){background:#222;padding:2px 4px;border-radius:4px;}
    </style>
  </head>
  <body>
    <header>
      <nav>
        <a href="/">Home</a>
        <a href="/games/index.html">Games</a>
        <a href="/reviews/index.html">Reviews</a>
        <a href="/tiers/index.html">Tiers</a>
      </nav>
    </header>
    <main>
      <h1>News</h1>
      {news.length === 0 ? (
        <p>No news yet.</p>
      ) : (
        news.map((item) => (
          <article class="news-item">
            <div class="news-date">{new Date(item.date_created).toLocaleDateString()}</div>
            <div class="news-body" set:html={marked.parse(item.body ?? "")} />
          </article>
        ))
      )}
    </main>
  </body>
</html>
