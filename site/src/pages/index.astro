---
import BaseLayout from "../layouts/BaseLayout.astro";
import { renderMarkdown } from "../lib/markdown";
import { directusFetchItems, fileUrl } from "../lib/directus";

const news = await directusFetchItems<{ id: number; date_created: string; body: string }>("news", {
  // Shared homepage image stored in Directus
  fields: ["id", "date_created", "body"],
  sort: ["-date_created"],
  limit: 50,
});

const heroImage = fileUrl({ id: "1ddf76e1-bbf2-42f4-9250-bd17bc3bb92c", filename_disk: "1ddf76e1-bbf2-42f4-9250-bd17bc3bb92c.png" });
---

<BaseLayout title="Jasmeralia">
  <div slot="head">
    <style>
      main{max-width:960px;margin:0 auto;padding:24px;}
      .news-item{border:1px solid #232323;border-radius:12px;padding:16px;margin:16px 0;background:#111;}
      .news-date{font-size:.85rem;opacity:.7;margin-bottom:8px;}
      .news-body :global(p){margin:0 0 12px 0;}
      .news-body :global(a){color:#8ab4f8;}
      .news-body :global(code){background:#222;padding:2px 4px;border-radius:4px;}
      .hero-image{margin:1.25rem 0 12px 0;}
      .hero-image img{width:100%;max-width:720px;height:auto;display:block;margin:0 auto;border-radius:12px;}
    </style>
  </div>
  <main>
      {heroImage ? (
        <div class="hero-image">
          <img src={heroImage} alt="Jasmeralia" loading="lazy" />
        </div>
      ) : null}
      <h1>News</h1>
      {news.length === 0 ? (
        <p>No news yet.</p>
      ) : (
        news.map((item) => (
          <article class="news-item">
            <div class="news-date">{new Date(item.date_created).toLocaleDateString()}</div>
            <div class="news-body" set:html={renderMarkdown(item.body ?? "")} />
          </article>
        ))
      )}
  </main>
</BaseLayout>
