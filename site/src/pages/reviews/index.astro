---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { directusFetchItems } from '../../lib/directus';
import { formatDate } from "../../lib/date";

const reviews = await directusFetchItems('reviews', {
  fields: ['id', 'title', 'slug', 'published_at', 'rating'],
  filter: { status: { _eq: "published" } },
  sort: ['-published_at', 'title'],
  limit: 500,
});
---

<BaseLayout title="Reviews">
  <div slot="head">
    <style>
      main{max-width:1100px;margin:0 auto;padding:24px;}
      .panel{background:#111;border:1px solid #222;border-radius:12px;padding:16px;}
      .panel a{color:#9aa6ff;}
      .panel a:visited{color:#9aa6ff;}
    </style>
  </div>
  <main>
      <div class="panel">
        <h1>Reviews</h1>
        {reviews.length === 0 ? (
          <p>No reviews yet.</p>
        ) : (
          <ul>
            {reviews.map((r) => (
              <li>
                <a href={`/reviews/${r.slug}/index.html`}>{r.title}</a>
                {typeof r.rating === "number" ? <span> (Rating: {r.rating}/10)</span> : null}
                {r.published_at ? <span style="opacity:.6;margin-left:.5rem;">Published: {formatDate(r.published_at)}</span> : null}
              </li>
            ))}
          </ul>
        )}
      </div>
  </main>
</BaseLayout>
