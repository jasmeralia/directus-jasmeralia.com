---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { directusFetchItems } from "../../lib/directus";

const statuses = [
  { value: "unreleased", label: "Unreleased" },
  { value: "in_development", label: "In Development" },
  { value: "abandoned", label: "Abandoned" },
  { value: "completed", label: "Completed" },
];
const games = await directusFetchItems("games", {
  fields: ["id", "game_status"],
  limit: 1000,
});
const statusCounts = new Map();
for (const game of games) {
  const value = game.game_status;
  if (!value) continue;
  statusCounts.set(value, (statusCounts.get(value) || 0) + 1);
}
---

<BaseLayout title="Game Statuses">
  <div slot="head">
    <style>
      main{max-width:980px;margin:0 auto;padding:24px;}
      ul{list-style:disc;padding-left:20px;}
      .panel{background:#111;border:1px solid #222;border-radius:12px;padding:16px;}
      .panel a{color:#9aa6ff;}
      .panel a:visited{color:#9aa6ff;}
    </style>
  </div>
  <main>
      <div class="panel">
        <h1>Game Statuses</h1>
        <ul>
          {statuses.map((status) => (
            <li>
              <a href={`/game_statuses/${status.value}/index.html`}>{status.label}</a>
              <span style="opacity:.7;"> ({statusCounts.get(status.value) || 0})</span>
            </li>
          ))}
        </ul>
      </div>
  </main>
</BaseLayout>
