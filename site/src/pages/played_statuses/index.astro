---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { directusFetchItems } from "../../lib/directus";

const games = await directusFetchItems("games", {
  fields: ["id", "player_status"],
  limit: 1000,
});

const labelize = (value) =>
  value ? value.replace(/_/g, " ").replace(/\b\w/g, (c) => c.toUpperCase()) : "";

const statusSet = new Set();
const statusCounts = new Map();
for (const game of games) {
  const status = game.player_status;
  if (!status) continue;
  statusSet.add(status);
  statusCounts.set(status, (statusCounts.get(status) || 0) + 1);
}

const statuses = Array.from(statusSet).sort((a, b) => a.localeCompare(b));
---

<BaseLayout title="Played Statuses">
  <div slot="head">
    <style>
      main{max-width:980px;margin:0 auto;padding:24px;}
      ul{list-style:disc;padding-left:20px;}
      .panel{background:#111;border:1px solid #222;border-radius:12px;padding:16px;}
      .panel a{color:#9aa6ff;}
      .panel a:visited{color:#9aa6ff;}
    </style>
  </div>
  <main>
      <div class="panel">
        <h1>Played Statuses</h1>
        {statuses.length === 0 ? (
          <p>No played statuses yet.</p>
        ) : (
          <ul>
            {statuses.map((status) => (
              <li>
                <a href={`/played_statuses/${status}/index.html`}>{labelize(status)}</a>
                <span style="opacity:.7;"> ({statusCounts.get(status) || 0})</span>
              </li>
            ))}
          </ul>
        )}
      </div>
  </main>
</BaseLayout>
