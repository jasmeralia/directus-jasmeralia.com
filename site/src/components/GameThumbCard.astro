---
import { fileUrl } from "../lib/directus";

const { game, reviewed = false } = Astro.props;
const labelize = (value) =>
  value ? value.replace(/_/g, " ").replace(/\b\w/g, (c) => c.toUpperCase()) : "";

const img = game?.cover_image ? fileUrl(game.cover_image) : null;
const genres = (game?.genres ?? []).map((genre) => genre?.genres_id?.name).filter(Boolean);
const engines = (game?.engines ?? []).map((engine) => engine?.engines_id?.title).filter(Boolean);
---

<div class={`card${reviewed ? " reviewed" : ""}`}>
  <a href={`/games/${game.slug}/index.html`}>
    <div class="thumb">
      {img ? <img src={img} alt={game.title} loading="lazy" /> : <span>No cover</span>}
    </div>
    <div class="meta">
      <div class="title">{game.title}</div>
      {game.release_year ? <div class="year">{game.release_year}</div> : null}
      <div class="tags">
        {game.player_status ? <span class="tag">{labelize(game.player_status)}</span> : null}
        {game.game_status ? <span class="tag">{labelize(game.game_status)}</span> : null}
        {genres.map((name) => <span class="tag">{name}</span>)}
        {engines.map((name) => <span class="tag">{name}</span>)}
      </div>
    </div>
  </a>
</div>

<style>
  .card{border:1px solid #2b2b2b;border-radius:12px;overflow:hidden;background:#111;}
  .card.reviewed{border-color:#d3a43b;box-shadow:0 0 0 1px rgba(211,164,59,.25);}
  .card a{color:inherit;text-decoration:none;display:block;}
  .thumb{aspect-ratio:2/3;background:#000;display:flex;align-items:center;justify-content:center;}
  .thumb img{width:100%;height:100%;object-fit:contain;display:block;}
  .meta{padding:.75rem 1rem;}
  .title{font-weight:700;}
  .year{opacity:.75;font-size:.9rem;}
  .tags{display:flex;flex-wrap:wrap;gap:.35rem;margin-top:.5rem;}
  .tag{font-size:.75rem;padding:.2rem .5rem;border-radius:999px;background:#1a1a1a;border:1px solid #2b2b2b;opacity:.9;}
</style>
